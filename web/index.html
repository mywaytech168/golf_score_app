<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Golf Score Web</title>
  </head>
  <body>
    <div id="app"></div>
    <!-- 雲端影片清單區 -->
    <h2>雲端影片清單</h2>
    <div id="cloud-gallery"></div>
    <!-- 以 ES 模組方式載入進入點 -->
    <script type="module" src="/src/main.js"></script>
    <script>
      // 取得 WebDAV 伺服器中的影片並顯示
      async function loadCloudVideos() {
        const res = await fetch('http://192.168.1.50/videos/', { method: 'PROPFIND' })
        const text = await res.text()
        const parser = new DOMParser()
        const xml = parser.parseFromString(text, 'application/xml')
        const hrefs = Array.from(xml.getElementsByTagName('d:href'))
        const gallery = document.getElementById('cloud-gallery')
        gallery.innerHTML = ''
        hrefs.forEach(h => {
          const name = decodeURIComponent(h.textContent)
          if (/\.(mp4|webm)$/.test(name) && !name.endsWith('/')) {
            const video = document.createElement('video')
            video.src = 'http://192.168.1.50' + name
            video.controls = true
            video.width = 300
            gallery.appendChild(video)
          }
        })
      }
      loadCloudVideos()
      // 暴露給外部以便錄影頁面呼叫刷新
      window.loadCloudVideos = loadCloudVideos
    </script>
  </body>
</html>
